<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Uploader的常用配置</title>
<link rel="stylesheet" type="text/css" href="http://docs.kissyui.com/kissy-dpl/base/build/css/dpl-pkg.css"/>
<link rel="stylesheet" type="text/css" href="assets/demo.css"/>
<script src="http://a.tbcdn.cn/s/kissy/1.2.0/kissy.js" charset="utf-8"></script>
</head>
<body>
<article id="doc">
    <h4>Uploader的常用配置</h4>
    <h5>先来看个最简单的demo</h5>
    <p>点击下来的按钮，上传1个文件试下</p>
    <!-- 上传按钮，组件配置请写在data-config内 -->
    <a id="J_UploaderBtn" class="g-u uploader-button uploader-button-focus" data-config=
            '{"type" : "ajax",
                "theme" : "uploader/themes/default",
                "autoUpload" : false,
                "serverConfig":{"action":"upload.php","data":{"dir":"files/"},"dataType" : "json"},
                "name":"Filedata",
                "urlsInputName":"fileUrls"}'
       href="#">
        选择要上传的文件
    </a>
    <!-- 路径urls -->
    <input type="hidden" value="" name="fileUrls" />
    <!-- 文件上传队列 -->
    <ul id="J_UploaderQueue">

    </ul>
    <div class="btn-wrapper">
        <input id="J_UploadAll" type="button" value="上传所有等待的文件">
    </div>
    <h5>组件参数配置情况</h5>
    <ul>
        <li>上传方式：<b id="J_UploadType"></b>，还有auto、ajax二个值，当为ajax时，如果浏览器不支持ajax，自动降级为iframe</li>
        <li>模板：<b id="J_Theme"></b>，为模板路径</li>
        <li>自动上传：<b id="J_AutoUpload"></b>，默认是true</li>
        <li>服务器端配置：<b id="J_ServerConfig"></b></li>
        <li>文件上传域名：<b id="J_FileName"></b></li>
        <li>路径input名：<b id="J_UrlsInput"></b></li>
    </ul>
    <h5>RenderUploader的init事件</h5>
    <p>如果你需要对初始化后监听的上传组件进行操作，比如删除文件后弹出个提示或者达到某个上传数需要禁用上传按钮等，</p>
    <p>那么需要监听RenderUploader实例的init事件，因为初始化Uploader前，要加载下模板js，这个过程很有可能是异步的。</p>
    <textarea name="code" class="xml:nocontrols" rows="10" cols="100">
        S.use('uploader/render', function (S, RenderUploader) {
                //第一个参数：按钮元素钩子，第二个参数：队列元素钩子
                var ru = new RenderUploader('#J_UploaderBtn', '#J_UploaderQueue');
                //对组件的后续操作务必放在init事件内，因为组件时可能需要异步加载模板
                ru.on("init",function(ev){
                    var uploader = ev.uploader;
                })
            })
    </textarea>
    init事件的event对象带有uploader，为Uploader的实例，获取到这个实例后，就可以对组件进行操作。
    <h5>获取Uploader实例的属性</h5>
    form组件包内的UI组件都继承于Base，所以获取属性，需要使用get方法，比如uploader.get('type')（uploader为Uploader的实例）。
    <textarea name="code" class="xml:nocontrols" rows="10" cols="100">
        ru.on("init",function(ev){
            var uploader = ev.uploader;
            $('#J_UploadType').text(uploader.get('type'));
            $('#J_Theme').text(uploader.get('theme'));
            $('#J_AutoUpload').text(uploader.get('autoUpload'));
        })
    </textarea>
    从理论上讲，你可以使用set方法变更配置，比如可以控制是否自动上传：uploader.set('autoUpload',true)，
    但很多属性只支持只读，比如type，theme属性。
    <h5>uploadAll()方法</h5>
    <textarea name="code" class="xml:nocontrols" rows="10" cols="100">

    </textarea>
</article>
<script>
    var S = KISSY;
    //配置模板加载基路径
    S.Config.base = '../../';
    //加载上传组件入口文件
    S.use('uploader/render', function (S, RenderUploader) {
        //第一个参数：按钮元素钩子，第二个参数：队列元素钩子
        var ru = new RenderUploader('#J_UploaderBtn', '#J_UploaderQueue');
        //对组件的后续操作务必放在init事件内，因为组件时可能需要异步加载模板
        ru.on("init",function(ev){
            var $ = S.Node.all,
                    //上传组件实例
                    uploader = ev.uploader,
                    //上传按钮实例
                    button = uploader.get('button');
            $('#J_UploadType').text(uploader.get('type'));
            $('#J_Theme').text(uploader.get('theme'));
            $('#J_AutoUpload').text(uploader.get('autoUpload'));
            $('#J_ServerConfig').text(uploader.get('serverConfig').toString());
            //留意文件上传域的name值是通过Button实例获取
            $('#J_FileName').text(button.get('name'));
            $('#J_UrlsInput').text(uploader.get('urlsInputName'));

            //点击上传，开始上传等待中的文件
            $('#J_UploadAll').on('click', function(ev) {
                uploader.uploadAll();
            })
        })
    })
</script>

<!-- 代码高亮 START  -->
<script type="text/javascript" src="http://www.36ria.com/sh/Scripts/shCore.js"></script>
<script type="text/javascript" src="http://www.36ria.com/sh/Scripts/shBrushJScript.js"></script>
<script type="text/javascript" src="http://www.36ria.com/sh/Scripts/shBrushXml.js"></script>
<link type="text/css" rel="stylesheet" href="http://www.36ria.com/sh/Styles/SyntaxHighlighter.css"/>
<script type="text/javascript">dp.SyntaxHighlighter.HighlightAll('code');</script>
<!-- 代码高亮 END  -->
</body>
</html>
